<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.5.2/cyborg/bootstrap.min.css">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.2/angular.min.js"></script>
    
    <title>AshRated's Store</title>
    
    <script type="text/javascript">
        // EXACT LINKS TO YOUR FILES (Case-Sensitive!)
        const itemListURL = "https://raw.githubusercontent.com/AshRated/item-list/master/StoreItems.json";
        const eventListURL = "https://raw.githubusercontent.com/AshRated/item-list/master/StoreEvents.json";
        const shopExtURL = "https://raw.githubusercontent.com/AshRated/item-list/master/ShopExt.json";
        const commandsURL = "https://raw.githubusercontent.com/AshRated/item-list/master/commands.json";
    </script>

    <style>
        /* Custom "Streamer" Styles */
        body { padding-top: 5rem; }
        .jumbotron {
            background-color: #2A2A2A; /* Darker grey card */
            border: 1px solid #444;
            box-shadow: 0px 4px 10px rgba(0,0,0,0.5);
        }
        .table-hover tbody tr:hover {
            color: #fff;
            background-color: #444; /* Highlight row on mouseover */
        }
        .nav-link { font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .sort { cursor: pointer; }
        /* Sort Arrows */
        .sort:after { display: inline-block; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-bottom: 5px solid transparent; content: ""; position: relative; top: -10px; right: -5px; }
        .sort.asc:after { border-top: 5px solid #fff; top: 4px; }
        .sort.desc:after { border-bottom: 5px solid #fff; top: -4px; }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">ASH RATED</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarsExampleDefault">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active"><a class="nav-link" href="#">Store Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="https://www.twitch.tv/ashrated" target="_blank">Twitch Channel</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main role="main">
        <div class="container">
            <div class="jumbotron mt-3">
                <h1 class="display-4">AshRated's Colony Store</h1>
                <p class="lead">Spend your hard-earned coins to help (or chaos) the colony.</p>
                <hr class="my-4" style="border-color: #555;">
                <p><strong>Status:</strong> Prices active and synced.</p>
            </div>

            <div ng-app='tabs' ng-controller='tabCtrl'>
                <div class='tabs mb-4'>
                    <form>
                        <div class="btn-group btn-group-toggle d-flex" data-toggle="buttons">
                            <label class="btn btn-outline-primary active" ng-click='selected=1'>
                                <input type="radio" checked> Items
                            </label>
                            <label class="btn btn-outline-danger" ng-click='selected=2'>
                                <input type="radio"> Events
                            </label>
                            <label class="btn btn-outline-warning" ng-click='selected=3'>
                                <input type="radio"> Traits & Races
                            </label>
                            <label class="btn btn-outline-info" ng-click='selected=4'>
                                <input type="radio"> Chat Commands
                            </label>
                        </div>
                        
                        <div class="form-group row mt-3" ng-show="selected != 4">
                            <label class="col-sm-2 col-form-label text-right">Price Range:</label>
                            <div class="col-sm-3">
                                <input type="number" class="form-control" id="item-price-min" placeholder="Min">
                            </div>
                            <div class="col-sm-3">
                                <input type="number" class="form-control" id="item-price-max" placeholder="Max">
                            </div>
                        </div>
                    </form>
                </div>

                <div ng-show='selected == 1'>
                    <div id="items">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend"><span class="input-group-text">Search</span></div>
                            <input type="text" class="form-control search" placeholder="Search for beer, wood, weapons...">
                        </div>
                        <div class="mb-2">
                            <button type="button" class="btn btn-sm btn-primary sort" data-sort="abr">Sort Name</button>
                            <button type="button" class="btn btn-sm btn-primary sort" data-sort="price">Sort Price</button>
                        </div>
                        <table class="table table-hover table-striped">
                            <thead><tr><th class="sort" data-sort="abr">Item Name</th><th class="sort" data-sort="price">Cost</th><th class="sort" data-sort="category">Category</th></tr></thead>
                            <tbody class="list"></tbody>
                        </table>
                    </div>
                </div>

                <div ng-show='selected == 2'>
                    <div id="events">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend"><span class="input-group-text">Search</span></div>
                            <input type="text" class="form-control search" placeholder="Search events...">
                        </div>
                        <div class="mb-2">
                            <button type="button" class="btn btn-sm btn-danger sort" data-sort="abr">Sort Name</button>
                            <button type="button" class="btn btn-sm btn-danger sort" data-sort="price">Sort Price</button>
                            <button type="button" class="btn btn-sm btn-danger sort" data-sort="karmatype">Sort Type</button>
                        </div>
                        <table class="table table-hover table-striped">
                            <thead><tr><th class="sort" data-sort="abr">Event Name</th><th class="sort" data-sort="price">Cost</th><th class="sort" data-sort="karmatype">Type</th></tr></thead>
                            <tbody class="list"></tbody>
                        </table>
                    </div>
                </div>

                <div ng-show='selected == 3'>
                    <div id="traits">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend"><span class="input-group-text">Search</span></div>
                            <input type="text" class="form-control search" placeholder="Search traits...">
                        </div>
                        <div class="mb-2">
                            <button type="button" class="btn btn-sm btn-warning sort" data-sort="name">Sort Name</button>
                            <button type="button" class="btn btn-sm btn-warning sort" data-sort="addPrice">Sort Price</button>
                        </div>
                        <table class="table table-hover table-striped">
                            <thead><tr><th class="sort" data-sort="name">Name</th><th>Description</th><th class="sort" data-sort="addPrice">Add Cost</th><th class="sort" data-sort="removePrice">Remove Cost</th></tr></thead>
                            <tbody class="list"></tbody>
                        </table>
                    </div>
                </div>

                <div ng-show='selected == 4'>
                    <div id="commands">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend"><span class="input-group-text">Search</span></div>
                            <input type="text" class="form-control search" placeholder="Search commands...">
                        </div>
                        <table class="table table-hover table-striped">
                            <thead><tr><th class="sort" data-sort="usage">Command</th><th class="sort" data-sort="description">Description</th><th class="sort" data-sort="userLevel">Permission</th><th class="sort" data-sort="mod">Source</th></tr></thead>
                            <tbody class="list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    
    <script type="text/javascript">
        // 1. ITEMS
        let itemList = null;
        $.getJSON(itemListURL, function(data) {
            var options = { valueNames: ['abr', 'price', 'category'], item: '<tr><td class="abr font-weight-bold text-white"></td><td class="price text-success"></td><td class="category text-muted"></td></tr>' };
            var itemData = [];
            $.each(data.items, function(index, value) { if (value["price"] > 0) itemData.push(value); });
            itemList = new List('items', options, itemData);
        });

        // 2. EVENTS
        let eventList = null;
        $.getJSON(eventListURL, function(data) {
            var options = { valueNames: ['abr', 'price', 'karmatype'], item: '<tr><td class="abr font-weight-bold text-white"></td><td class="price text-danger"></td><td class="karmatype"></td></tr>' };
            var eventData = [];
            $.each(data.incitems, function(index, value) { if (value["price"] > 0) eventData.push(value); });
            eventList = new List('events', options, eventData);
        });

        // 3. TRAITS
        let traitList = null;
        $.getJSON(shopExtURL, function(data) {
            var options = { valueNames: ['name', 'description', 'addPrice', 'removePrice'], item: '<tr><td class="name font-weight-bold text-warning"></td><td class="description small"></td><td class="addPrice"></td><td class="removePrice"></td></tr>' };
            var combinedData = [];
            if(data.traits){ $.each(data.traits, function(index, value) { combinedData.push({ name: value.defName, description: value.description, addPrice: value.addPrice, removePrice: value.removePrice }); }); }
            if(data.races){ $.each(data.races, function(index, value) { if (value.enabled) { combinedData.push({ name: value.defName + " (Race)", description: value.description, addPrice: value.price, removePrice: "N/A" }); } }); }
            traitList = new List('traits', options, combinedData);
        });

        // 4. COMMANDS
        let commandList = null;
        $.getJSON(commandsURL, function(data) {
            var options = { valueNames: ['usage', 'description', 'userLevel', 'mod'], item: '<tr><td class="usage font-weight-bold text-info"></td><td class="description small"></td><td class="userLevel"></td><td class="mod text-muted small"></td></tr>' };
            var cmdData = [];
            $.each(data, function(index, value) {
                let modSource = (value.data && value.data.mod) ? value.data.mod : "Unknown";
                cmdData.push({ usage: value.usage, description: value.description, userLevel: value.userLevel, mod: modSource });
            });
            commandList = new List('commands', options, cmdData);
        });

        // FILTERS
        $("#item-price-min, #item-price-max").keyup(function() {
            var min = $("#item-price-min").val();
            var max = $("#item-price-max").val();
            var filterFunc = function(item) {
                var price = parseInt(item.values().price || item.values().addPrice);
                if (min != "" && price < min) return false;
                if (max != "" && price > max) return false;
                return true;
            };
            if(itemList) itemList.filter(filterFunc);
            if(eventList) eventList.filter(filterFunc);
            if(traitList) traitList.filter(filterFunc);
        });

        var tabs = angular.module('tabs', []).controller('tabCtrl', function($scope) { $scope.selected = "1"; });
    </script>
</body>
</html>
